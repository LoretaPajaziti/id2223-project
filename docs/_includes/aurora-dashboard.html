<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
  .aurora-dashboard {
    font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
    background: radial-gradient(circle at top, #0b1020, #05060d);
    color: #eaeaf0;
    padding: 3rem 2rem;
    border-radius: 20px;
    max-width: 1100px;
    margin: 3rem auto;
  }

  .aurora-dashboard h1 {
    font-size: 2.4rem;
    margin-bottom: 0.2rem;
  }

  .aurora-subtitle {
    color: #9aa4ff;
    margin-bottom: 2rem;
  }

  .aurora-card {
    background: rgba(255, 255, 255, 0.05);
    border-radius: 16px;
    padding: 1.5rem;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
  }

  .aurora-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
    gap: 1rem;
    margin-top: 2rem;
  }

  .aurora-risk {
    font-size: 1.8rem;
    font-weight: bold;
  }

  .very-low {
    color: #4ade80;
  }
  .moderate {
    color: #facc15;
  }
  .likely {
    color: #fb923c;
  }
  .very-likely {
    color: #f87171;
  }

  .aurora-footer {
    margin-top: 2.5rem;
    font-size: 0.85rem;
    color: #8a8fae;
  }
</style>

<div class="aurora-dashboard">
  <h1>Aurora Outlook (Sweden)</h1>
  <div class="aurora-subtitle">
    Probability of aurora-favorable geomagnetic conditions in the next 5 days
  </div>

  <!-- Plot -->
  <div class="aurora-card">
    <canvas id="auroraProbChart" height="90"></canvas>
  </div>

  <!-- Risk cards -->
  <div class="aurora-grid" id="auroraRiskGrid"></div>

  <div class="aurora-footer">
    Forecast based on geomagnetic, solar-wind, and weather data processed by a
    machine-learning model. Uncertainty increases with forecast horizon.
  </div>
</div>

<script>
  fetch("./assets/predictions.json")
    .then((res) => res.json())
    .then((predictions) => {
      const horizons = predictions.map((p) => `+${p.horizon_days}d`);
      const probs = predictions.map((p) => p.probability);

      // ---- Line chart ----
      const ctx = document.getElementById("auroraProbChart").getContext("2d");

      new Chart(ctx, {
        type: "line",
        data: {
          labels: horizons,
          datasets: [
            {
              data: probs,
              borderColor: "#9aa4ff",
              backgroundColor: "rgba(154,164,255,0.25)",
              fill: true,
              tension: 0.4,
              pointRadius: 5,
            },
          ],
        },
        options: {
          plugins: { legend: { display: false } },
          scales: {
            y: { beginAtZero: true, max: 1 },
          },
        },
      });

      // ---- Risk cards ----
      const grid = document.getElementById("auroraRiskGrid");

      function category(p) {
        if (p < 0.2) return { label: "Very unlikely", cls: "very-low" };
        if (p < 0.4) return { label: "Moderate chance", cls: "moderate" };
        if (p < 0.6) return { label: "Likely", cls: "likely" };
        return { label: "Very likely", cls: "very-likely" };
      }

      predictions.forEach((p) => {
        const c = category(p.probability);

        const div = document.createElement("div");
        div.className = "aurora-card";
        div.innerHTML = `
        <div>Day +${p.horizon_days}</div>
        <div class="aurora-risk ${c.cls}">
          ${(p.probability * 100).toFixed(1)}%
        </div>
        <div>${c.label}</div>
      `;
        grid.appendChild(div);
      });
    })
    .catch((err) => {
      console.error("Failed to load aurora predictions:", err);
    });
</script>
